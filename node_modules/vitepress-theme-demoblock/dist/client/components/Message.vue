<template>
  <transition-group name="demoblock-fade-transition" tag="div" class="demoblock-messages">
    <template v-for="item in messages" :key="item.name">
      <div class="demoblock-message-wrap">
        <div :class="['demoblock-message', item.type ? `demoblock-message--${item.type}` : '']">
          <component :is="components[item.type]" class="demoblock-message-icon" />
          <div class="demoblock-message-content">{{ item.content }}</div>
        </div>
      </div>
    </template>
  </transition-group>
</template>

<script>
import { ref, defineComponent } from 'vue'
import FluentCheckmarkCircle16Filled from '../icons/FluentCheckmarkCircle16Filled.vue'
import FluentDismissCircle16Filled from '../icons/FluentDismissCircle16Filled.vue'
import FluentErrorCircle16Filled from '../icons/FluentErrorCircle16Filled.vue'

let seed = 0
function getUuid() {
  return 'message_' + seed++
}
export default defineComponent({
  components: {
    FluentCheckmarkCircle16Filled,
    FluentDismissCircle16Filled,
    FluentErrorCircle16Filled
  },
  setup() {
    const components = {
      info: 'FluentErrorCircle16Filled',
      success: 'FluentCheckmarkCircle16Filled',
      warning: 'FluentDismissCircle16Filled',
      error: 'FluentErrorCircle16Filled'
    }

    const messages = ref([])
    function add(props) {
      const name = getUuid()
      const _message = { name, show: true, ...props }
      messages.value.push(_message)
      const duration = props.duration
      setTimeout(() => {
        remove(name)
      }, duration * 1000)
    }
    function remove(name) {
      for (const [i, v] of messages.value.entries()) {
        if (v.name === name) {
          messages.value.splice(i, 1)
          break
        }
      }
    }
    function hidden(name) {
      const message = messages.value.find(x => x.name === name)
      message.show = false
    }

    return { components, messages, add, remove }
  }
})
</script>

<style scoped>
.demoblock-messages{align-items:center;display:flex;flex-direction:column;height:0;left:0;overflow:visible;position:fixed;right:0;top:12px;transition:color .3s var(--demoblock-bezier) 0s,background-color .3s var(--demoblock-bezier) 0s;z-index:6000;--demoblock-bezier:cubic-bezier(0.4,0,0.2,1);--demoblock-icon-color-info:#2080f0;--demoblock-icon-color-success:#18a058;--demoblock-icon-color-warning:#f0a020;--demoblock-icon-color-error:#d03050;--demoblock-message-text-color:#333639;--demoblock-message-bg-color:#fff}html.dark .demoblock-messages{--demoblock-icon-color-info:#70c0e8;--demoblock-icon-color-success:#63e2b7;--demoblock-icon-color-warning:#f2c97d;--demoblock-icon-color-error:#e88080;--demoblock-message-text-color:hsla(0,0%,100%,.82);--demoblock-message-bg-color:#48484e}.demoblock-message-wrap{align-items:flex-start;display:flex;margin:0 0 8px;transform-origin:top center;z-index:0}.demoblock-message{align-items:center;background-color:var(--demoblock-message-bg-color);border-radius:3px;box-shadow:0 3px 6px -4px rgba(0,0,0,.12),0 6px 16px 0 rgba(0,0,0,.08),0 9px 28px 8px rgba(0,0,0,.05);color:var(--demoblock-message-text-color);display:flex;flex-wrap:nowrap;max-width:720px;overflow:hidden;padding:10px 20px;transition:color .3s var(--demoblock-bezier),box-shadow .3s var(--demoblock-bezier),background-color .3s var(--demoblock-bezier),opacity .3s var(--demoblock-bezier),transform .3s var(--demoblock-bezier),margin-bottom .3s var(--demoblock-bezier)}.demoblock-message-icon{flex-shrink:0;font-size:23px;height:23px;margin:0 10px 0 0;position:relative;width:23px}.demoblock-message .demoblock-message-icon,.demoblock-message-icon{transition:color .3s var(--demoblock-bezier)}.demoblock-message--info .demoblock-message-icon{color:var(--demoblock-icon-color-info)}.demoblock-message--success .demoblock-message-icon{color:var(--demoblock-icon-color-success)}.demoblock-message--warning .demoblock-message-icon{color:var(--demoblock-icon-color-warning)}.demoblock-message--error .demoblock-message-icon{color:var(--demoblock-icon-color-error)}.demoblock-message-content{display:inline-block;font-size:14px;line-height:1.6}.demoblock-fade-transition-enter-to,.demoblock-fade-transition-leave-from{opacity:1;transform:scale(1)}.demoblock-fade-transition-enter-from,.demoblock-fade-transition-leave-to{margin-bottom:0!important;margin-top:0!important;opacity:0;transform:scale(.85)}.demoblock-fade-transition-leave-active{overflow:visible;transition:max-height .3s cubic-bezier(.4,0,.2,1) 0s,opacity .3s var(--demoblock-bezier) 0s,margin-top .3s var(--demoblock-bezier) 0s,margin-bottom .3s var(--demoblock-bezier) 0s,padding-top .3s var(--demoblock-bezier) 0s,padding-bottom .3s var(--demoblock-bezier) 0s,transform .3s var(--demoblock-bezier)}.demoblock-fade-transition-enter-active{overflow:visible;transition:max-height .3s var(--demoblock-bezier),opacity .3s cubic-bezier(.4,0,1,1),margin-top .3s var(--demoblock-bezier),margin-bottom .3s var(--demoblock-bezier),padding-top .3s var(--demoblock-bezier),padding-bottom .3s var(--demoblock-bezier),transform .3s var(--demoblock-bezier)}
</style>
